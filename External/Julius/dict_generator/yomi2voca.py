#!/usr/bin/python
# -*- coding: utf-8 -*-
# Julius for python convert by radiumproduction
# Copyright (c) 2007-2017 RadiumProduction

import os
import re


trans = [
    { "before": "う゛ぁ", "after": "b a " },
    { "before": "う゛ぃ", "after": "b i " },
    { "before": "う゛ぇ", "after": "b e " },
    { "before": "う゛ぉ", "after": "b o " },
    { "before": "う゛ゅ", "after": "by u " },
    { "before": "ぅ゛", "after": "b u " },
    { "before": "あぁ", "after": "a a " },
    { "before": "いぃ", "after": "i i " },
    { "before": "いぇ", "after": "i e " },
    { "before": "いゃ", "after": "y a " },
    { "before": "うぅ", "after": "u: " },
    { "before": "えぇ", "after": "e e " },
    { "before": "おぉ", "after": "o: " },
    { "before": "かぁ", "after": "k a: " },
    { "before": "きぃ", "after": "k i: " },
    { "before": "くぅ", "after": "k u: " },
    { "before": "くゃ", "after": "ky a " },
    { "before": "くゅ", "after": "ky u " },
    { "before": "くょ", "after": "ky o " },
    { "before": "けぇ", "after": "k e: " },
    { "before": "こぉ", "after": "k o: " },
    { "before": "がぁ", "after": "g a: " },
    { "before": "ぎぃ", "after": "g i: " },
    { "before": "ぐぅ", "after": "g u: " },
    { "before": "ぐゃ", "after": "gy a " },
    { "before": "ぐゅ", "after": "gy u " },
    { "before": "ぐょ", "after": "gy o " },
    { "before": "げぇ", "after": "g e: " },
    { "before": "ごぉ", "after": "g o: " },
    { "before": "さぁ", "after": "s a: " },
    { "before": "しぃ", "after": "sh i: " },
    { "before": "すぅ", "after": "s u: " },
    { "before": "すゃ", "after": "sh a " },
    { "before": "すゅ", "after": "sh u " },
    { "before": "すょ", "after": "sh o " },
    { "before": "せぇ", "after": "s e: " },
    { "before": "そぉ", "after": "s o: " },
    { "before": "ざぁ", "after": "z a: " },
    { "before": "じぃ", "after": "j i: " },
    { "before": "ずぅ", "after": "z u: " },
    { "before": "ずゃ", "after": "zy a " },
    { "before": "ずゅ", "after": "zy u " },
    { "before": "ずょ", "after": "zy o " },
    { "before": "ぜぇ", "after": "z e: " },
    { "before": "ぞぉ", "after": "z o: " },
    { "before": "たぁ", "after": "t a: " },
    { "before": "ちぃ", "after": "ch i: " },
    { "before": "つぁ", "after": "ts a " },
    { "before": "つぃ", "after": "ts i " },
    { "before": "つぅ", "after": "ts u: " },
    { "before": "つゃ", "after": "ch a " },
    { "before": "つゅ", "after": "ch u " },
    { "before": "つょ", "after": "ch o " },
    { "before": "つぇ", "after": "ts e " },
    { "before": "つぉ", "after": "ts o " },
    { "before": "てぇ", "after": "t e: " },
    { "before": "とぉ", "after": "t o: " },
    { "before": "だぁ", "after": "d a: " },
    { "before": "ぢぃ", "after": "j i: " },
    { "before": "づぅ", "after": "d u: " },
    { "before": "づゃ", "after": "zy a " },
    { "before": "づゅ", "after": "zy u " },
    { "before": "づょ", "after": "zy o " },
    { "before": "でぇ", "after": "d e: " },
    { "before": "どぉ", "after": "d o: " },
    { "before": "なぁ", "after": "n a: " },
    { "before": "にぃ", "after": "n i: " },
    { "before": "ぬぅ", "after": "n u: " },
    { "before": "ぬゃ", "after": "ny a " },
    { "before": "ぬゅ", "after": "ny u " },
    { "before": "ぬょ", "after": "ny o " },
    { "before": "ねぇ", "after": "n e: " },
    { "before": "のぉ", "after": "n o: " },
    { "before": "はぁ", "after": "h a: " },
    { "before": "ひぃ", "after": "h i: " },
    { "before": "ふぅ", "after": "f u: " },
    { "before": "ふゃ", "after": "hy a " },
    { "before": "ふゅ", "after": "hy u " },
    { "before": "ふょ", "after": "hy o " },
    { "before": "へぇ", "after": "h e: " },
    { "before": "ほぉ", "after": "h o: " },
    { "before": "ばぁ", "after": "b a: " },
    { "before": "びぃ", "after": "b i: " },
    { "before": "ぶぅ", "after": "b u: " },
    { "before": "ふゃ", "after": "hy a " },
    { "before": "ぶゅ", "after": "by u " },
    { "before": "ふょ", "after": "hy o " },
    { "before": "べぇ", "after": "b e: " },
    { "before": "ぼぉ", "after": "b o: " },
    { "before": "ぱぁ", "after": "p a: " },
    { "before": "ぴぃ", "after": "p i: " },
    { "before": "ぷぅ", "after": "p u: " },
    { "before": "ぷゃ", "after": "py a " },
    { "before": "ぷゅ", "after": "py u " },
    { "before": "ぷょ", "after": "py o " },
    { "before": "ぺぇ", "after": "p e: " },
    { "before": "ぽぉ", "after": "p o: " },
    { "before": "まぁ", "after": "m a: " },
    { "before": "みぃ", "after": "m i: " },
    { "before": "むぅ", "after": "m u: " },
    { "before": "むゃ", "after": "my a " },
    { "before": "むゅ", "after": "my u " },
    { "before": "むょ", "after": "my o " },
    { "before": "めぇ", "after": "m e: " },
    { "before": "もぉ", "after": "m o: " },
    { "before": "やぁ", "after": "y a: " },
    { "before": "ゆぅ", "after": "y u: " },
    { "before": "ゆゃ", "after": "y a: " },
    { "before": "ゆゅ", "after": "y u: " },
    { "before": "ゆょ", "after": "y o: " },
    { "before": "よぉ", "after": "y o: " },
    { "before": "らぁ", "after": "r a: " },
    { "before": "りぃ", "after": "r i: " },
    { "before": "るぅ", "after": "r u: " },
    { "before": "るゃ", "after": "ry a " },
    { "before": "るゅ", "after": "ry u " },
    { "before": "るょ", "after": "ry o " },
    { "before": "れぇ", "after": "r e: " },
    { "before": "ろぉ", "after": "r o: " },
    { "before": "わぁ", "after": "w a: " },
    { "before": "をぉ", "after": "o: " },
    { "before": "う゛", "after": "b u " },
    { "before": "でぃ", "after": "d i " },
    { "before": "でぇ", "after": "d e: " },
    { "before": "でゃ", "after": "dy a " },
    { "before": "でゅ", "after": "dy u " },
    { "before": "でょ", "after": "dy o " },
    { "before": "てぃ", "after": "t i " },
    { "before": "てぇ", "after": "t e: " },
    { "before": "てゃ", "after": "ty a " },
    { "before": "てゅ", "after": "ty u " },
    { "before": "てょ", "after": "ty o " },
    { "before": "すぃ", "after": "s i " },
    { "before": "ずぁ", "after": "z u a " },
    { "before": "ずぃ", "after": "z i " },
    { "before": "ずぅ", "after": "z u " },
    { "before": "ずゃ", "after": "zy a " },
    { "before": "ずゅ", "after": "zy u " },
    { "before": "ずょ", "after": "zy o " },
    { "before": "ずぇ", "after": "z e " },
    { "before": "ずぉ", "after": "z o " },
    { "before": "きゃ", "after": "ky a " },
    { "before": "きゅ", "after": "ky u " },
    { "before": "きょ", "after": "ky o " },
    { "before": "しゃ", "after": "sh a " },
    { "before": "しゅ", "after": "sh u " },
    { "before": "しぇ", "after": "sh e " },
    { "before": "しょ", "after": "sh o " },
    { "before": "ちゃ", "after": "ch a " },
    { "before": "ちゅ", "after": "ch u " },
    { "before": "ちぇ", "after": "ch e " },
    { "before": "ちょ", "after": "ch o " },
    { "before": "とぅ", "after": "t u " },
    { "before": "とゃ", "after": "ty a " },
    { "before": "とゅ", "after": "ty u " },
    { "before": "とょ", "after": "ty o " },
    { "before": "どぁ", "after": "d o a " },
    { "before": "どぅ", "after": "d u " },
    { "before": "どゃ", "after": "dy a " },
    { "before": "どゅ", "after": "dy u " },
    { "before": "どょ", "after": "dy o " },
    { "before": "どぉ", "after": "d o: " },
    { "before": "にゃ", "after": "ny a " },
    { "before": "にゅ", "after": "ny u " },
    { "before": "にょ", "after": "ny o " },
    { "before": "ひゃ", "after": "hy a " },
    { "before": "ひゅ", "after": "hy u " },
    { "before": "ひょ", "after": "hy o " },
    { "before": "みゃ", "after": "my a " },
    { "before": "みゅ", "after": "my u " },
    { "before": "みょ", "after": "my o " },
    { "before": "りゃ", "after": "ry a " },
    { "before": "りゅ", "after": "ry u " },
    { "before": "りょ", "after": "ry o " },
    { "before": "ぎゃ", "after": "gy a " },
    { "before": "ぎゅ", "after": "gy u " },
    { "before": "ぎょ", "after": "gy o " },
    { "before": "ぢぇ", "after": "j e " },
    { "before": "ぢゃ", "after": "j a " },
    { "before": "ぢゅ", "after": "j u " },
    { "before": "ぢょ", "after": "j o " },
    { "before": "じぇ", "after": "j e " },
    { "before": "じゃ", "after": "j a " },
    { "before": "じゅ", "after": "j u " },
    { "before": "じょ", "after": "j o " },
    { "before": "びゃ", "after": "by a " },
    { "before": "びゅ", "after": "by u " },
    { "before": "びょ", "after": "by o " },
    { "before": "ぴゃ", "after": "py a " },
    { "before": "ぴゅ", "after": "py u " },
    { "before": "ぴょ", "after": "py o " },
    { "before": "うぁ", "after": "u a " },
    { "before": "うぃ", "after": "w i " },
    { "before": "うぇ", "after": "w e " },
    { "before": "うぉ", "after": "w o " },
    { "before": "ふぁ", "after": "f a " },
    { "before": "ふぃ", "after": "f i " },
    { "before": "ふぅ", "after": "f u " },
    { "before": "ふゃ", "after": "hy a " },
    { "before": "ふゅ", "after": "hy u " },
    { "before": "ふょ", "after": "hy o " },
    { "before": "ふぇ", "after": "f e " },
    { "before": "ふぉ", "after": "f o " },
    { "before": "あ", "after": "a " },
    { "before": "い", "after": "i " },
    { "before": "う", "after": "u " },
    { "before": "え", "after": "e " },
    { "before": "お", "after": "o " },
    { "before": "か", "after": "k a " },
    { "before": "き", "after": "k i " },
    { "before": "く", "after": "k u " },
    { "before": "け", "after": "k e " },
    { "before": "こ", "after": "k o " },
    { "before": "さ", "after": "s a " },
    { "before": "し", "after": "sh i " },
    { "before": "す", "after": "s u " },
    { "before": "せ", "after": "s e " },
    { "before": "そ", "after": "s o " },
    { "before": "た", "after": "t a " },
    { "before": "ち", "after": "ch i " },
    { "before": "つ", "after": "ts u " },
    { "before": "て", "after": "t e " },
    { "before": "と", "after": "t o " },
    { "before": "な", "after": "n a " },
    { "before": "に", "after": "n i " },
    { "before": "ぬ", "after": "n u " },
    { "before": "ね", "after": "n e " },
    { "before": "の", "after": "n o " },
    { "before": "は", "after": "h a " },
    { "before": "ひ", "after": "h i " },
    { "before": "ふ", "after": "f u " },
    { "before": "へ", "after": "h e " },
    { "before": "ほ", "after": "h o " },
    { "before": "ま", "after": "m a " },
    { "before": "み", "after": "m i " },
    { "before": "む", "after": "m u " },
    { "before": "め", "after": "m e " },
    { "before": "も", "after": "m o " },
    { "before": "ら", "after": "r a " },
    { "before": "り", "after": "r i " },
    { "before": "る", "after": "r u " },
    { "before": "れ", "after": "r e " },
    { "before": "ろ", "after": "r o " },
    { "before": "が", "after": "g a " },
    { "before": "ぎ", "after": "g i " },
    { "before": "ぐ", "after": "g u " },
    { "before": "げ", "after": "g e " },
    { "before": "ご", "after": "g o " },
    { "before": "ざ", "after": "z a " },
    { "before": "じ", "after": "j i " },
    { "before": "ず", "after": "z u " },
    { "before": "ぜ", "after": "z e " },
    { "before": "ぞ", "after": "z o " },
    { "before": "だ", "after": "d a " },
    { "before": "ぢ", "after": "j i " },
    { "before": "づ", "after": "z u " },
    { "before": "で", "after": "d e " },
    { "before": "ど", "after": "d o " },
    { "before": "ば", "after": "b a " },
    { "before": "び", "after": "b i " },
    { "before": "ぶ", "after": "b u " },
    { "before": "べ", "after": "b e " },
    { "before": "ぼ", "after": "b o " },
    { "before": "ぱ", "after": "p a " },
    { "before": "ぴ", "after": "p i " },
    { "before": "ぷ", "after": "p u " },
    { "before": "ぺ", "after": "p e " },
    { "before": "ぽ", "after": "p o " },
    { "before": "や", "after": "y a " },
    { "before": "ゆ", "after": "y u " },
    { "before": "よ", "after": "y o " },
    { "before": "わ", "after": "w a " },
    { "before": "ゐ", "after": "i " },
    { "before": "ゑ", "after": "e " },
    { "before": "ん", "after": "N " },
    { "before": "っ", "after": "q " },
    { "before": "ー", "after": ": " },
    { "before": "ぁ", "after": "a " },
    { "before": "ぃ", "after": "i " },
    { "before": "ぅ", "after": "u " },
    { "before": "ぇ", "after": "e " },
    { "before": "ぉ", "after": "o " },
    { "before": "ゎ", "after": "w a " },
    { "before": "ぉ", "after": "o " },
    { "before": "を", "after": "o " }
]


def yomi2voca(filename, is_noise=False):

    error = 0
    lineno = 0
    yomi = open(os.path.dirname(os.path.abspath(__file__)) + "/" + filename + ".yomi", 'r', encoding="utf-8")
    voca = open(os.path.dirname(os.path.abspath(__file__)) + "/" + filename + ".voca", 'w', encoding="utf-8")

    for line in yomi:
        if re.match(u"^%", line):
            voca.write(line)
            continue
        
        word = line.split()
        word[1] = word[1].rstrip(os.linesep)

        for t in trans:
            word[1] = word[1].replace(t["before"], t["after"])

        word[1] = re.sub(r"^ ", "", word[1])
        word[1] = re.sub(r":+", ":", word[1])
        word[1] = re.sub(r" :", ":", word[1])

        lineno += 1
        if re.match(r"^[a-zA-Z:]+$", word[1]):
            if error == 0:
                error = 1
                print("Error: (they were also printed to stdout)" + "\n")
            print("line " + str(lineno) + ":" + word[0] + "\t" + word[1] + "\n")
        voca.write(word[0] + "\t" + word[1] + "\n")

    if is_noise:
        voca.write(r"% NOISE" + "\n")
        voca.write(r"<sp>" + "\tsp" + "\n")
    voca.write(r"% NS_B" + "\n")
    voca.write(r"<s>" + "\tsilB" + "\n")
    voca.write(r"% NS_E" + "\n")
    voca.write(r"</s>" + "\tsilE" + "\n")

    yomi.close()
    voca.close()
